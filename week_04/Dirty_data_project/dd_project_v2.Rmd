---
title: "dd_project_v2"
author: "nehali"
date: "24/03/2020"
output: html_document
---
```{r}
library(tidyverse)
library(janitor)
library(readxl)
```



/* TASK-1 */

```{r}
decathalon <- readRDS("dd_project_data/decathlon.rds")
decathalon
```

```{r}
decathalon_clean <- clean_names(decathalon)
decathalon_clean

```

```{r}
decathalon_reform <-decathalon_clean %>%
  rownames_to_column("surname") %>%
    rename(
    run_100m = x100m,
    rum_400m = x400m,
    hurdle_110m = x110m_hurdle,
    run_1500m = x1500m,
    javelin = javeline
  ) %>%
    mutate(
      surname = tolower(surname),
      competition = as.character(competition)
    ) %>%
    pivot_longer(run_100m:run_1500m, names_to = "event", values_to = "score")
  
  
```

# writing clean data to csv

```{r}
write_csv(decathalon_reform, "clean_data/decathalon_clean.csv")
```

```{r}
decathalon_reform <- decathalon_clean %>% rownames_to_column()
```

/* Who had the longest long jump seen in the data? */

```{r}
decathalon_reform %>%
  arrange(desc(long_jump)) %>%
  head(1)
  
```

/*   What was the average 100m time in each competition? */
```{r}
decathalon_reform %>%
  group_by(competition) %>%
  summarise(avg_time = mean(x100m))
```

/*3. Who had the highest total points across both competitions? */
```{r}
decathalon_reform %>%
  distinct(rowname, competition,points) %>%
  group_by(rowname) %>%
  summarise(points_total = sum(points)) %>%
  arrange(desc(points_total)) %>%
  head(1)
```
/*4.What was the shot-put scores for the top three competitors in each competition? */
```{r}
decathalon_reform %>%
  select(shot_put, rank, competition) %>%
  filter(rank <= 3)
```

/*5-What was the average points for competitors who ran the 400m in less than 50 seconds vs. those than ran 400m in more than 50 seconds?*/


```{r}
decathalon_reform %>%
  
  filter(x400m < 50) %>%
  mutate(fast_400 = x400m < 50) %>%
  group_by(fast_400) %>%
  summarise(avg_points = mean(points))

 
  
```

/* TASK-4 */



```{r}
candy_2015 <- read_excel("raw_data/boing-boing-candy-2015.xlsx")
candy_2016 <- read_excel("raw_data/boing-boing-candy-2016.xlsx")
candy_2017 <- read_excel("raw_data/boing-boing-candy-2017.xlsx")
```
/* data cleaning */

```{r}
candy_2015 <- clean_names(candy_2015)
candy_2016 <- clean_names(candy_2016)
candy_2017 <- clean_names(candy_2017)
```

/*remove prefix from col names of candy_2017 */

```{r}
names(candy_2017) <- str_remove(names(candy_2017), "q[0-9]+_")
```
/*making data clean- adding an id no, converting in long and then adding cols 'gender' and 'country', bind to 2017 data, adding a col 'year' so that while binding we'll know from which year data is coming*/
```{r}
candy_2015_clean <- candy_2015 %>%
  mutate(person_id = row_number()) %>%
  pivot_longer(x100_grand_bar:york_peppermint_patties, names_to = "candy", values_to = "rating")%>%
mutate(
  year = 2015,
  gender = NA,
  country = NA
  ) %>%
  select(year, person_id, going_out = are_you_going_actually_going_trick_or_treating_yourself, age = how_old_are_you, gender, country, candy, rating )


```

```{r}
candy_2016_clean <- candy_2016 %>%
  mutate(person_id = max(candy_2015_clean$person_id) + row_number()) %>%
  pivot_longer(x100_grand_bar:york_peppermint_patties, names_to = "candy", values_to = "rating")%>%
  mutate(
    year = 2016) %>%
  select(year, person_id,going_out = are_you_going_actually_going_trick_or_treating_yourself,
    age = how_old_are_you,
    gender = your_gender,
    country = which_country_do_you_live_in,
    candy,
    rating
    )
  
```


```{r}
candy_2017_clean <- candy_2017 %>%
  rename(x100_grand_bar = '100_grand_bar')%>%
  mutate(person_id = max(candy_2016_clean$person_id) + row_number()) %>%
  pivot_longer(x100_grand_bar:york_peppermint_patties, names_to = "candy", values_to = "rating")%>%
  mutate(
    year = 2017) %>%
  select(year, person_id, going_out, gender, age,country, candy, rating
         )
  
```
/* Binding all data */
```{r}
candy_combined <- rbind(candy_2015_clean, candy_2016_clean, candy_2017_clean)
```

```{r}
candy_combined_tidy <- candy_combined %>%
  mutate(age =  as.numeric(age),
         rating = str_to_lower(rating),
         country = str_to_loer(country)
         )
```



/* Analysing questions*/
```{r}
candy_clean_data <- read.csv("clean_data/candy_clean.csv")
candy_clean_data
```

/*1. What is the total number of candy ratings given across the three years. Hint: Number of candy ratings, not number of raters.*/
```{r}
candy_clean_data%>%
filter(!is.na(rating))%>%
  nrow()
```
/*2-What was the average age of people who are going out trick or treating and the average age of people not going trick or treating?* /
```{r}
candy_clean_data%>%
  group_by(going_out) %>%
  summarise(avg_age = mean(age,na.rm = TRUE))
  
```
/*3.For each of joy, despair and meh, which candy bar recieved these ratings the most? */



```{r}
candy_clean_data%>%
  filter(!is.na(rating)) %>%
  group_by(rating, candy) %>%
  summarise(count = n() )%>%
  filter(count == max(count))
  
```


/*4. How many people rated Starburst as despair? */
```{r}
candy_clean_data%>%
  filter(candy == "starbust") %>%
  filter(rating == "despair")%>%
  summarise(id_count = n_distinct(person_id))
  
```

